<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Glowy GO ! ç¥ç€åœ°åœ–</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #fdfaf5; font-family: -apple-system, sans-serif; }
        #map { width: 100vw; height: 100vh; }
        
        /* ç¥ç€å°é»é» */
        .gmap-dot {
            background-color: #FFBF00 !important; border: 1px solid #FFFFFF !important;
            border-radius: 50% !important; width: 8px !important; height: 8px !important;
            display: block !important; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* æ§åˆ¶é¢æ¿ï¼šæ”¹ç‚ºé ‚éƒ¨å›ºå®š */
        .filter-panel {
            position: absolute; top: 15px; left: 0; right: 0;
            z-index: 1000; display: flex; flex-wrap: wrap; gap: 8px; padding: 0 15px; justify-content: center;
        }
        
        .filter-btn {
            background: white; padding: 10px 18px; border-radius: 25px; font-size: 14px;
            border: 1.5px solid #FFBF00; color: #D28E5D; font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer;
        }

        /* å•Ÿå‹•ç‹€æ…‹ */
        .filter-btn.active { background: #FFBF00; color: white; }

        /* ä¸‹æ–¹ç‹€æ…‹æ¬„ */
        #status-bar {
            position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: rgba(0,0,0,0.7); color: white;
            padding: 8px 20px; border-radius: 30px; font-size: 12px; white-space: nowrap;
        }
    </style>
</head>
<body>

    <div class="filter-panel">
        <div id="btn-gov" class="filter-btn active" onclick="toggleFilter('gov')">ğŸ›ï¸ å…¬å®¶æ©Ÿé—œ</div>
        <div id="btn-mall" class="filter-btn active" onclick="toggleFilter('mall')">ğŸ›ï¸ è³¼ç‰©/æ°‘ç‡Ÿ</div>
        <div id="btn-trans" class="filter-btn active" onclick="toggleFilter('trans')">ğŸš‰ äº¤é€šæ¨ç´</div>
    </div>

    <div id="status-bar">æ­£åœ¨è¼‰å…¥å…¨åœ‹ç¥ç€ç©ºé–“...</div>
    <div id="map"></div>

    <script>
        var map = L.map('map', { zoomControl: false, attributionControl: false }).setView([25.056, 121.511], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        var amberIcon = L.divIcon({ className: 'none', html: '<div class="gmap-dot"></div>', iconSize: [8, 8], iconAnchor: [4, 4] });
        
        var allSpots = []; 
        var activeFilters = ['gov', 'mall', 'trans']; 
        var markerLayer = L.layerGroup().addTo(map);

        async function init() {
            try {
                // ä½¿ç”¨å…¬å…± API ä»£ç†ç¢ºä¿è³‡æ–™è®€å–æˆåŠŸ
                const response = await fetch('https://raw.githubusercontent.com/kiang/nurseries/master/data.json');
                const data = await response.json();
                
                allSpots = data.features.map(f => {
                    let type = 'gov'; // é è¨­ç‚ºå…¬å®¶
                    const name = f.properties.name || "";
                    // å„ªåŒ–åˆ†é¡é‚è¼¯ï¼šæ›´å»£æ³›çš„é—œéµå­—æ¯”å°
                    if (/(ç™¾è²¨|è³¼ç‰©|å•†å ´|å¤§æ¨“|é£¯åº—|é¤å»³|èª å“|æ–°å…‰)/.test(name)) type = 'mall';
                    else if (/(ç«™|æ©Ÿå ´|æ·é‹|è½‰é‹|éµè·¯)/.test(name)) type = 'trans';
                    
                    return {
                        coords: [f.geometry.coordinates[1], f.geometry.coordinates[0]],
                        name: name,
                        address: f.properties.address || "æš«ç„¡åœ°å€è³‡è¨Š",
                        type: type
                    };
                });
                updateUI();
            } catch (e) {
                document.getElementById('status-bar').innerText = "é€£ç·šç•°å¸¸ï¼Œè«‹é‡æ–°æ•´ç†ç¶²é ";
            }
        }

        function updateUI() {
            markerLayer.clearLayers();
            let count = 0;

            allSpots.forEach(spot => {
                if (activeFilters.includes(spot.type)) {
                    L.marker(spot.coords, { icon: amberIcon })
                     .bindPopup(`<b>${spot.name}</b><br><small>${spot.address}</small>`)
                     .addTo(markerLayer);
                    count++;
                }
            });
            document.getElementById('status-bar').innerText = `å·²é¡¯ç¤º ${count} è™•ç¥ç€ç©ºé–“`;
        }

        function toggleFilter(type) {
            const btn = document.getElementById('btn-' + (type === 'trans' ? 'trans' : (type === 'mall' ? 'mall' : 'gov')));
            
            if (activeFilters.includes(type)) {
                activeFilters = activeFilters.filter(t => t !== type);
                btn.classList.remove('active');
            } else {
                activeFilters.push(type);
                btn.classList.add('active');
            }
            updateUI();
        }

        init();
        map.locate({setView: true, maxZoom: 15});
    </script>
</body>
</html>

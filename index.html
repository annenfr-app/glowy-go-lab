<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glowy GO ! | ç”Ÿå‘½å²æ¡é›†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        .user-dot { width: 18px; height: 18px; background: #3B82F6; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 15px rgba(59,130,246,0.6); }
        .facility-dot { width: 10px; height: 10px; background: rgba(255, 191, 0, 0.5); border: 1.5px solid white; border-radius: 50%; pointer-events: none; }
        .event-marker {
            width: 34px; height: 34px; background: #FFBF00; border: 3px solid white; border-radius: 50%;
            display: flex; items-center; justify-center; font-size: 16px; box-shadow: 0 0 20px rgba(255,191,0,0.8);
            position: relative;
        }
        .event-marker::after {
            content: ''; position: absolute; width: 100%; height: 100%; border-radius: 50%;
            background: #FFBF00; opacity: 0.5; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(2.2); opacity: 0; } }
        #capture-page { display: none; transition: all 0.4s ease; }
    </style>
</head>
<body class="bg-gray-50">

    <div id="main-ui">
        <div class="fixed top-4 left-0 right-0 z-[1000] px-4 flex gap-3">
            <div class="flex-grow bg-white/90 backdrop-blur h-12 rounded-full shadow-lg flex items-center px-4 border border-amber-100">
                <span class="text-gray-400 text-sm">æ¢ç´¢èº«é‚Šçš„å¯¶ç‰©æ´»å‹•...</span>
            </div>
        </div>

        <div id="map"></div>

        <div id="drawer" class="fixed bottom-0 left-0 right-0 z-[2000] bg-white rounded-t-[32px] shadow-2xl px-8 pt-4 pb-10 transition-all duration-500 transform translate-y-full">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <div id="drawer-content"></div>
        </div>
    </div>

    <div id="capture-page" class="fixed inset-0 z-[3000] bg-white overflow-y-auto px-6 py-10">
        <div class="flex justify-between items-center mb-8">
            <button onclick="closeCapture()" class="text-gray-400">å–æ¶ˆ</button>
            <h2 class="text-xl font-bold">åˆ»ç•«ç”Ÿå‘½å°è¨˜</h2>
            <div class="w-8"></div>
        </div>

        <div class="space-y-8">
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-3">æ•æ‰é€™ä¸€åˆ» (ç…§ç‰‡æˆ–éŒ„å½±)</label>
                <div onclick="document.getElementById('file-input').click()" class="w-full h-64 bg-gray-50 border-2 border-dashed border-amber-200 rounded-3xl flex flex-col items-center justify-center gap-2 text-amber-500 active:bg-amber-50">
                    <span class="text-4xl">ğŸ“¸</span>
                    <span class="text-sm font-medium">é»æ“Šé–‹å•Ÿç›¸æ©Ÿ</span>
                    <input type="file" id="file-input" class="hidden" accept="image/*,video/*">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-3">æ­¤åˆ»çš„å¿ƒæƒ…æ–‡å­—</label>
                <textarea class="w-full bg-gray-50 rounded-2xl p-4 border-none focus:ring-2 focus:ring-amber-400 min-h-[150px]" placeholder="å¯«ä¸‹æ‚¨èˆ‡å­©å­åœ¨é€™è£¡çš„æ•…äº‹..."></textarea>
            </div>

            <button onclick="finishCapture()" class="w-full bg-amber-400 text-white py-4 rounded-2xl font-bold shadow-xl shadow-amber-100 active:scale-95 transition-all">
                æ­£å¼å­˜å…¥ç”Ÿå‘½å²
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([48.8566, 2.3522], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        let eventLayer = L.layerGroup().addTo(map);
        let currentEvent = null;

        // å¯¶ç‰©æ´»å‹•è³‡æ–™
        const events = [
            { id: 101, name: "ğŸ¨ ç¾…æµ®å®®ï¼šå°å°è—è¡“å®¶å°è¦½", lat: 48.8606, lon: 2.3376, desc: "é€™æ˜¯ä¸€å€‹å°ˆç‚ºè¦ªå­è¨­è¨ˆçš„è—è¡“æ¢ç´¢è¡Œç¨‹ã€‚" },
            { id: 102, name: "ğŸª æœæ¨‚éº—ï¼šé€±æœ«æ—‹è½‰æœ¨é¦¬æ´¾å°", lat: 48.8640, lon: 2.3270, desc: "ç´€éŒ„ä¸‹å­©å­ç¬¬ä¸€æ¬¡åœ¨æ—‹è½‰æœ¨é¦¬ä¸Šçš„ç¬‘å®¹ã€‚" }
        ];

        // æ¸²æŸ“é–ƒçˆçš„å¯¶ç‰©é»
        function renderEvents() {
            events.forEach(evt => {
                const icon = L.divIcon({ className: '', html: `<div class="event-marker">âœ¨</div>`, iconSize: [34, 34] });
                L.marker([evt.lat, evt.lon], { icon }).addTo(eventLayer).on('click', () => openDrawer(evt));
            });
        }

        // é–‹å•Ÿåº•éƒ¨æŠ½å±œ
        function openDrawer(evt) {
            currentEvent = evt;
            const drawer = document.getElementById('drawer');
            document.getElementById('drawer-content').innerHTML = `
                <h3 class="text-2xl font-bold text-gray-800">${evt.name}</h3>
                <p class="text-gray-500 mt-2 text-sm">${evt.desc}</p>
                <div class="mt-8 flex gap-3">
                    <button class="flex-1 border-2 border-amber-400 text-amber-600 py-4 rounded-2xl font-bold">ğŸ—ºï¸ å°èˆª</button>
                    <button onclick="goToCapture()" class="flex-[1.5] bg-amber-400 text-white py-4 rounded-2xl font-bold shadow-lg shadow-amber-100">âœ¨ æ¡é›†æˆåŠŸ</button>
                </div>
            `;
            drawer.classList.remove('translate-y-full');
            map.flyTo([evt.lat, evt.lon], 16);
        }

        // é€²å…¥å°ˆé 
        function goToCapture() {
            document.getElementById('capture-page').style.display = 'block';
            document.getElementById('main-ui').style.opacity = '0.3';
        }

        function closeCapture() {
            document.getElementById('capture-page').style.display = 'none';
            document.getElementById('main-ui').style.opacity = '1';
        }

        // å®Œæˆæ¡é›†æµç¨‹
        function finishCapture() {
            alert(`ã€æ¡é›†æˆåŠŸã€‘\næ‚¨å·²å®Œæˆã€Œ${currentEvent.name}ã€çš„ç´€éŒ„ã€‚\né€™æ®µæ™‚å…‰å·²æ­£å¼å­˜å…¥æ‚¨çš„ç”Ÿå‘½å²ï¼`);
            closeCapture();
            document.getElementById('drawer').classList.add('translate-y-full');
            // æ­¤è™•æœªä¾†å¯å¯¦ä½œå­˜å…¥ localStorage æˆ–è³‡æ–™åº«
        }

        window.onload = () => {
            renderEvents();
            map.locate({ setView: true, maxZoom: 16 });
        };
    </script>
</body>
</html>

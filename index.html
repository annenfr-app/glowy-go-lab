<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glowy GO ! | å¸¶å¯¶å¯¶ä¹Ÿèƒ½å‡ºé–€å»ç©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; overflow: hidden; touch-action: manipulation; }
        #map { height: 100vh; width: 100vw; z-index: 1; background: #f8f9fa; }
        
        /* ç¥ç€è‰²ä¸»é¡Œæ¨™è¨˜ */
        .amber-dot { width: 22px; height: 22px; background: #FFBF00; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 12px rgba(255,191,0,0.7); }
        .facility-dot { width: 12px; height: 12px; background: rgba(255, 191, 0, 0.65); border: 2px solid white; border-radius: 50%; }
        .user-dot { width: 18px; height: 18px; background: #3B82F6; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 10px rgba(59,130,246,0.5); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .leaflet-control-zoom { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">

    <div class="fixed top-4 left-0 right-0 z-[1000] px-4 flex items-center gap-3">
        <div class="flex-grow bg-white/95 backdrop-blur h-12 rounded-full shadow-lg flex items-center px-4 gap-3 border border-gray-100 active:scale-95 transition-all" onclick="alert('é€²å…¥ SNCF æœå°‹æ¬¡é ')">
            <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2"></path></svg>
            <span class="text-gray-400 text-sm font-medium">è¦å»å“ªè£¡ç©ï¼Ÿ(å€åŸŸã€æ—¥æœŸ...)</span>
        </div>
        <div class="w-12 h-12 bg-white rounded-full shadow-lg border-2 border-amber-200 flex items-center justify-center overflow-hidden" onclick="alert('é€²å…¥æœƒå“¡å…¥å£ï¼šç”Ÿå‘½å²æ„Ÿã€é»æ•¸éŒ¢åŒ…')">
            <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Lucky" class="w-full h-full object-cover">
        </div>
    </div>

    <div class="fixed top-20 left-0 right-0 z-[1000] flex gap-2 px-4 overflow-x-auto no-scrollbar">
        <button onclick="updateData('baby_care')" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border border-transparent active:bg-amber-50">ğŸ¼ å“ºä¹³å®¤</button>
        <button onclick="updateData('toilets')" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border border-transparent active:bg-amber-50">ğŸš¾ å…¬å»</button>
        <button onclick="updateData('drinking_water')" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border border-transparent active:bg-amber-50">ğŸ’§ é£²æ°´æ©Ÿ</button>
        <button onclick="updateData('elevator')" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border border-transparent active:bg-amber-50">ğŸ›— é›»æ¢¯</button>
    </div>

    <button class="fixed right-6 top-36 z-[1000] w-12 h-12 bg-white rounded-full shadow-2xl flex items-center justify-center text-gray-700 active:text-amber-500 transition-all border border-gray-100" onclick="handlePermissionAndLocate()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path></svg>
    </button>

    <div id="map"></div>

    <div class="fixed bottom-0 left-0 right-0 z-[2000] bg-white rounded-t-[32px] shadow-[0_-10px_30px_rgba(0,0,0,0.1)] px-8 pt-4 pb-10">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
        <div class="flex justify-between items-center text-center">
            <div class="flex flex-col items-center gap-1 cursor-pointer">
                <div class="p-3 bg-amber-400 text-white rounded-2xl shadow-lg mb-1">ğŸ§­</div>
                <span class="text-xs font-bold text-gray-900">æ¢ç´¢</span>
            </div>
            <div class="flex flex-col items-center gap-1 opacity-40 grayscale cursor-pointer" onclick="alert('é–‹å•Ÿå°è³¼èˆ‡æ”¯æ´æœå°‹')">
                <div class="p-3 mb-1 text-2xl">ğŸ›’</div>
                <span class="text-xs font-bold">å‘¨é‚Šæ”¯æ´</span>
            </div>
            <div class="flex flex-col items-center gap-1 opacity-40 grayscale cursor-pointer" onclick="alert('å›å ±è¨­æ–½ç•°å‹•')">
                <div class="p-3 mb-1 text-2xl">ğŸ”§</div>
                <span class="text-xs font-bold">è²¢ç»</span>
            </div>
            <div class="flex flex-col items-center gap-1 opacity-40 grayscale cursor-pointer" onclick="alert('é–‹å•Ÿå¡åŒ…èˆ‡ç¬¬ä¸‰æ–¹æœå‹™')">
                <div class="p-3 mb-1 text-2xl">ğŸ§§</div>
                <span class="text-xs font-bold">å…¶ä»–</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([25.033, 121.565], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        let facilityLayer = L.layerGroup().addTo(map);
        let userMarker = null;

        // æˆæ¬Šå®šä½é‚è¼¯
        async function handlePermissionAndLocate() {
            map.locate({ setView: true, maxZoom: 16, enableHighAccuracy: true });
        }

        map.on('locationfound', function(e) {
            if (userMarker) map.removeLayer(userMarker);
            userMarker = L.marker(e.latlng, { icon: L.divIcon({ className: 'user-dot', iconSize: [18, 18] }) }).addTo(map);
            map.flyTo(e.latlng, 16);
            updateData('baby_care'); // å®šä½æˆåŠŸå¾Œè‡ªå‹•æŠ“å–å“ºä¹³å®¤åœ–è³‡
        });

        // å…¨çƒ OpenData æŠ“å– (Overpass API) - å„ªåŒ–æœå°‹æ¨™ç±¤
        async function updateData(type) {
            const bounds = map.getBounds();
            const bbox = `${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()}`;
            
            let queryTag = '';
            if(type === 'baby_care') queryTag = 'nwr["amenity"~"baby_hatch|changing_room|baby_care"];nwr["changing_table"="yes"];';
            if(type === 'toilets') queryTag = 'nwr["amenity"="toilets"];';
            if(type === 'drinking_water') queryTag = 'nwr["amenity"="drinking_water"];';
            if(type === 'elevator') queryTag = 'nwr["highway"="elevator"];nwr["amenity"="elevator"];';

            const query = `[out:json][timeout:25];(${queryTag});out center(${bbox});`;
            const url = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`;

            try {
                const res = await fetch(url);
                const data = await res.json();
                facilityLayer.clearLayers();
                data.elements.forEach(el => {
                    const lat = el.lat || (el.center && el.center.lat);
                    const lon = el.lon || (el.center && el.center.lon);
                    if (lat && lon) {
                        L.marker([lat, lon], { icon: L.divIcon({ className: 'facility-dot', iconSize: [12, 12] }) }).addTo(facilityLayer);
                    }
                });
            } catch (err) { console.error("åœ–è³‡è¼‰å…¥å¤±æ•—"); }
        }

        window.onload = handlePermissionAndLocate;
    </script>
</body>
</html>

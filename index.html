<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glowy GO !</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #map { height: 100vh; width: 100vw; background: #f8f9fa; }
        .user-dot { width: 18px; height: 18px; background: #3B82F6; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 15px rgba(59,130,246,0.6); }
        .facility-dot { width: 12px; height: 12px; background: rgba(255, 191, 0, 0.7); border: 2px solid white; border-radius: 50%; pointer-events: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* æœå°‹æ­¤å€åŸŸæŒ‰éˆ•æ¨£å¼ */
        #search-this-area {
            position: fixed; top: 140px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: none;
            background: white; padding: 8px 20px; border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); font-weight: bold; font-size: 14px;
        }
        @keyframes ping {
  75%, 100% { transform: scale(2); opacity: 0; }
}
.animate-ping {
  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
}
    </style>
</head>
<body class="bg-gray-50">

    <div class="fixed top-4 left-0 right-0 z-[1000] px-4 flex items-center gap-3">
        <div class="flex-grow bg-white/95 backdrop-blur h-12 rounded-full shadow-lg flex items-center px-4 gap-3 border border-gray-100">
            <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2"></path></svg>
            <span class="text-gray-400 text-sm">è¦å»å“ªè£¡ç©ï¼Ÿ(å·´é»ã€å°åŒ—...)</span>
        </div>
        <div class="w-12 h-12 bg-white rounded-full shadow-lg border-2 border-amber-200 flex items-center justify-center overflow-hidden">
            <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Lucky" class="w-full h-full">
        </div>
    </div>

    <div class="fixed top-20 left-0 right-0 z-[1000] flex gap-2 px-4 overflow-x-auto no-scrollbar">
        <button onclick="currentType='baby_care'; updateData();" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border active:bg-amber-50">ğŸ¼ å“ºä¹³å®¤</button>
        <button onclick="currentType='toilets'; updateData();" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border active:bg-amber-50">ğŸš¾ å…¬å»</button>
        <button onclick="currentType='drinking_water'; updateData();" class="flex-shrink-0 px-5 py-2 bg-white rounded-full shadow-md text-xs font-bold border active:bg-amber-50">ğŸ’§ é£²æ°´æ©Ÿ</button>
    </div>

    <button id="search-this-area" onclick="updateData()">
        ğŸ”„ æœå°‹æ­¤å€åŸŸçš„è¨­æ–½
    </button>

    <button class="fixed right-6 top-36 z-[1000] w-12 h-12 bg-white rounded-full shadow-xl flex items-center justify-center text-blue-500 border" onclick="locateUser()">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path></svg>
    </button>

    <div id="map"></div>

    <div class="fixed bottom-0 left-0 right-0 z-[2000] bg-white rounded-t-[32px] shadow-[0_-10px -30px_rgba(0,0,0,0.1)] px-8 pt-4 pb-10">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
        <div class="flex justify-between items-center text-center">
            <div class="flex flex-col items-center gap-1"><div class="p-3 bg-amber-400 text-white rounded-2xl shadow-lg">ğŸ§­</div><span class="text-xs font-bold">æ¢ç´¢</span></div>
            <div class="flex flex-col items-center gap-1 opacity-30 grayscale text-2xl">ğŸ›’<span class="text-[10px]">æ”¯æ´</span></div>
            <div class="flex flex-col items-center gap-1 opacity-30 grayscale text-2xl">ğŸ”§<span class="text-[10px]">è²¢ç»</span></div>
            <div class="flex flex-col items-center gap-1 opacity-30 grayscale text-2xl">ğŸ§§<span class="text-[10px]">å…¶ä»–</span></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
   // 1. æ–°å¢ï¼šæ´»å‹•é»åœ–å±¤
let eventLayer = L.layerGroup().addTo(map);

// 2. æ¨¡æ“¬æ´»å‹•è³‡æ–™ (å¯¶ç‰©) - æœªä¾†å¯å°æ¥ä½ çš„æ´»å‹•è³‡æ–™åº«
const mockEvents = [
    { id: 1, name: "ğŸ¨ ç¾…æµ®å®®è¦ªå­å·¥ä½œåŠ", lat: 48.8606, lon: 2.3376, desc: "é©åˆ 3-6 æ­²ï¼Œæ¢ç´¢è—è¡“ä¹‹ç¾" },
    { id: 2, name: "ğŸª æœæ¨‚éº—è¦ªå­å˜‰å¹´è¯", lat: 48.8635, lon: 2.3275, desc: "é€±æœ«é™å®šï¼æ—‹è½‰æœ¨é¦¬èˆ‡å‰µæ„å¸‚é›†" },
    { id: 3, name: "ğŸ“– èå£«æ¯”äºæ›¸åº—æ•…äº‹æœƒ", lat: 48.8525, lon: 2.3471, desc: "è½è‹±èªç¹ªæœ¬æ•…äº‹ï¼Œæ¡é›†æ–‡å­¸èƒ½é‡" }
];

// 3. æ¸²æŸ“æ´»å‹•é»å‡½å¼
function renderEvents() {
    eventLayer.clearLayers();
    
    // å®šç¾©ç¥ç€è‰²å¤§é»çš„ CSS (å¸¶æœ‰å‘¼å¸ç‡ˆå‹•ç•«)
    const eventIcon = L.divIcon({
        className: 'event-marker-container',
        html: `
            <div class="relative flex items-center justify-center">
                <div class="absolute w-10 h-10 bg-amber-400 rounded-full animate-ping opacity-20"></div>
                <div class="w-6 h-6 bg-amber-500 border-2 border-white rounded-full shadow-lg flex items-center justify-center text-[10px]">âœ¨</div>
            </div>
        `,
        iconSize: [40, 40]
    });

    mockEvents.forEach(evt => {
        L.marker([evt.lat, evt.lon], { icon: eventIcon })
        .addTo(eventLayer)
        .on('click', () => {
            showEventDetail(evt); // é»æ“Šæ´»å‹•é»è§¸ç™¼ç´°ç¯€
        });
    });
}

// 4. é¡¯ç¤ºæ´»å‹•ç´°ç¯€ (èˆ‡åº•éƒ¨æŠ½å±œäº’å‹•)
function showEventDetail(evt) {
    // é€™è£¡æˆ‘å€‘å…ˆç”¨ç°¡å–®çš„å½ˆçª—æ¨¡æ“¬ï¼Œä¸‹ä¸€æ­¥å¯ä»¥å¯¦ä½œæŠ½å±œå‡èµ·
    const detailHtml = `
        <div class="p-4">
            <h3 class="font-bold text-lg text-amber-600">${evt.name}</h3>
            <p class="text-sm text-gray-600 mt-1">${evt.desc}</p>
            <button onclick="startCapture(${evt.id})" class="w-full mt-4 bg-amber-500 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all">
                ğŸ“ å‰å¾€æ¡é›†å¯¶ç‰©
            </button>
        </div>
    `;
    
    // è®“åœ°åœ–é£›å‘è©²é»
    map.flyTo([evt.lat, evt.lon], 17);
    
    // é€™è£¡å¯ä»¥å°‡ detailHtml å¡å…¥ä½ çš„åº•éƒ¨æŠ½å±œ Div
    alert(`ç™¼ç¾å¯¶ç‰©ï¼š${evt.name}\n${evt.desc}`);
}

// 5. åœ¨ window.onload ä¸­åŠ å…¥æ¸²æŸ“
window.onload = () => {
    handlePermissionAndLocate();
    renderEvents(); // åˆå§‹åŒ–æ´»å‹•é»
};
</script>

</body>
</html>

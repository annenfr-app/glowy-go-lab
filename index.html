<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Glowy GO ! å…¨åœ‹ç¥ç€åœ°åœ–</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #fdfaf5; }
        #map { width: 100vw; height: 100vh; }
        .gmap-dot {
            background-color: #FFBF00 !important;
            border: 1px solid #FFFFFF !important;
            border-radius: 50% !important;
            width: 8px !important; height: 8px !important;
            display: block !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .ui-overlay {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: 8px; width: 90%;
        }
        .tag {
            background: white; padding: 6px 14px; border-radius: 20px; font-size: 13px;
            border: 1px solid #FFBF00; color: #D28E5D; font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #status-tag { font-size: 11px; background: rgba(255,191,0,0.1); }
    </style>
</head>
<body>

    <div class="ui-overlay">
        <div class="tag">ğŸ¼ å…¨åœ‹å“ºé›†ä¹³å®¤å‹•æ…‹åœ°åœ–</div>
        <div id="status-tag" class="tag">æ­£åœ¨é€£ç·šæ”¿åºœè³‡æ–™åº«...</div>
    </div>

    <div id="map"></div>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ–
        var map = L.map('map', { zoomControl: false, attributionControl: false }).setView([25.056, 121.511], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        var amberIcon = L.divIcon({
            className: 'none',
            html: '<div class="gmap-dot"></div>',
            iconSize: [8, 8], iconAnchor: [4, 4]
        });

        // 2. ä¸²æ¥å…¨åœ‹é–‹æ”¾è³‡æ–™ (ä½¿ç”¨è¡›ç¦éƒ¨å…¬é–‹è³‡æ–™)
        const dataUrl = 'https://raw.githubusercontent.com/kiang/nurseries/master/data.json';

        async function loadData() {
            try {
                const response = await fetch(dataUrl);
                const data = await response.json();
                const statusTag = document.getElementById('status-tag');
                
                // 3. è™•ç†ä¸¦é¡¯ç¤ºè³‡æ–™
                let count = 0;
                data.features.forEach(feature => {
                    const coords = feature.geometry.coordinates;
                    const info = feature.properties;
                    
                    // ç¶“ç·¯åº¦åè½‰ (OpenData é€šå¸¸æ˜¯ [ç¶“, ç·¯]ï¼ŒLeaflet æ˜¯ [ç·¯, ç¶“])
                    L.marker([coords[1], coords[0]], { icon: amberIcon })
                     .bindPopup(`<b>${info.name}</b><br>${info.address}<br>é–‹æ”¾æ™‚é–“: ${info.opening_hours || 'è©³è¦‹å®˜ç¶²'}`)
                     .addTo(map);
                    count++;
                });

                statusTag.innerText = `å·²é»äº®å…¨åœ‹ ${count} è™•ç¥ç€ç©ºé–“`;
            } catch (error) {
                console.error("æŠ“å–è³‡æ–™å¤±æ•—:", error);
                document.getElementById('status-tag').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
            }
        }

        // å•Ÿå‹•è¼‰å…¥
        loadData();

        // 4. è‡ªå‹•å®šä½åˆ°ä½¿ç”¨è€…ä½ç½®
        map.locate({setView: true, maxZoom: 15});
    </script>
</body>
</html>

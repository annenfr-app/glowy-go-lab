<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Glowy GO ! Global</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root { --amber: #FFBF00; --blue: #4285F4; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: -apple-system, sans-serif; background: #fdfaf5; }
        
        /* åœ°åœ–å±¤ */
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* é ‚éƒ¨æœå°‹æ¢ + å³ä¸Šè§’é ­è²¼ */
        .header-ui {
            position: absolute; top: calc(env(safe-area-inset-top) + 15px); left: 12px; right: 12px;
            z-index: 1000; display: flex; flex-direction: column; gap: 10px;
        }
        .search-bar-row { display: flex; align-items: center; gap: 10px; }
        .search-box {
            flex: 1; background: white; height: 50px; border-radius: 25px;
            display: flex; align-items: center; padding: 0 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12); border: 1px solid rgba(0,0,0,0.05);
        }
        .search-box input { flex: 1; border: none; outline: none; font-size: 16px; margin-left: 10px; }
        .avatar {
            width: 50px; height: 50px; border-radius: 25px; background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12); border: 2px solid white; cursor: pointer; overflow: hidden;
        }

        /* åº•éƒ¨åŠŸèƒ½åˆ— */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 80px;
            background: rgba(255,255,255,0.98); z-index: 2000; display: flex;
            border-top: 1px solid #eee; padding-bottom: env(safe-area-inset-bottom);
        }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; font-size: 11px; }
        .tab-item.active { color: var(--amber); }

        /* å®šä½æŒ‰éˆ• */
        .locate-btn {
            position: absolute; bottom: 100px; right: 20px; z-index: 1000;
            background: white; width: 54px; height: 54px; border-radius: 27px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; border: none; font-size: 24px;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="header-ui">
        <div class="search-bar-row">
            <div class="search-box">
                <span>ğŸ”</span>
                <input type="text" placeholder="å°‹æ‰¾èº«é‚Šçš„ç¥ç€æ•‘æ´é»...">
            </div>
            <div class="avatar" onclick="alert('æœƒå“¡å¤§æœ¬ç‡Ÿï¼šå¯¶å¯¶è³‡æ–™ã€25ç©é»ã€æ¡è³¼æ­·å²ã€åå¥½è¨­å®š')">
                <img src="https://api.dicebear.com/7.x/micah/svg?seed=Glowy" style="width:100%">
            </div>
        </div>
    </div>

    <button class="locate-btn" onclick="triggerGPS()">ğŸ¯</button>

    <div class="tab-bar">
        <div class="tab-item active"><span>ğŸ—ºï¸</span>åœ°åœ–</div>
        <div class="tab-item"><span>âœï¸</span>è²¢ç»</div>
        <div class="tab-item"><span>ğŸ“¸</span>å¯«çœŸé›†</div>
        <div class="tab-item"><span>ğŸ—‚ï¸</span>å¡åŒ…</div>
    </div>

    <script>
        // åˆå§‹åŒ–åœ°åœ–ï¼šæ”¯æŒå…¨çƒåº§æ¨™
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([48.8566, 2.3522], 14); // é è¨­å·´é»ï¼Œå±•ç¾è·¨åœ‹è¦–é‡
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        let userMarker, radiusCircle;
        let pointsLayer = L.layerGroup().addTo(map);

        // ğŸŸ¢ æ ¸å¿ƒï¼šè·¨åœ‹ Open Data ä»‹æ¥é‚è¼¯
        function fetchGlobalData(lat, lng) {
            console.log(`æ­£åœ¨æŠ“å–åº§æ¨™ [${lat}, ${lng}] çš„å…¨çƒå‹å–„è¨­æ–½æ•¸æ“š...`);
            pointsLayer.clearLayers();
            
            // æ¨¡æ“¬çœŸå¯¦è³‡æ–™åˆ†ä½ˆï¼šåœ¨ç•¶å‰è¦–é‡å…§é¡¯ç¤ºé»ä½
            for (let i = 0; i < 15; i++) {
                const randomLat = lat + (Math.random() - 0.5) * 0.02;
                const randomLng = lng + (Math.random() - 0.5) * 0.02;
                L.circleMarker([randomLat, randomLng], {
                    radius: 7, fillColor: "#FFBF00", color: "white", weight: 2, fillOpacity: 0.9
                }).addTo(pointsLayer).bindPopup("å‹å–„è¨­æ–½ï¼šè¼‰å…¥ä¸­...");
            }
        }

        // ğŸ”µ å®šä½è§¸ç™¼
        function triggerGPS() {
            map.locate({setView: true, maxZoom: 16, enableHighAccuracy: true});
        }

        map.on('locationfound', function(e) {
            if (userMarker) map.removeLayer(userMarker);
            if (radiusCircle) map.removeLayer(radiusCircle);

            userMarker = L.circleMarker(e.latlng, {
                radius: 9, fillColor: "#4285F4", color: "white", weight: 3, fillOpacity: 1
            }).addTo(map);

            radiusCircle = L.circle(e.latlng, {
                radius: 400, color: "#FFBF00", weight: 1, fillOpacity: 0.05
            }).addTo(map); // é¡¯ç¤º 5 åˆ†é˜æ‡‰æ€¥åœˆç¯„åœ

            fetchGlobalData(e.latlng.lat, e.latlng.lng);
        });

        // åˆå§‹è¼‰å…¥èˆ‡å®šä½
        window.onload = () => {
            fetchGlobalData(48.8566, 2.3522); // åˆå§‹å·´é»é»ä½
            setTimeout(triggerGPS, 1000);
        };
    </script>
</body>
</html>
